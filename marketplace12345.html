<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Cowboy County</title>
    <link href="./style.css" rel="stylesheet">
    <!-- Moralis SDK code -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://unpkg.com/moralis-v1/dist/moralis.js"></script>
</head>

<body>
    <!-- Navigation Bar -->
    <div class=top>
        <div class=logo>
            <img src="./images/logo_white.png">
        </div>
        <div class=top-container>
            <h1><a href="./index.html">Home</a></h1>
        </div>
        <div class=top-container>
            <h1><a href="./about-us.html">About Us</a></h1>
        </div>
        <div class=top-container>
            <h1><a href="./mint.html">Mint</a></h1>
        </div>
        <div class=top-container>
            <h1><a href="./staking.html">Staking</a></h1>
        </div>
        <div class=top-container>
            <h1><a href="./claim.html">Claiming</a></h1>
        </div>
    </div>
    <!-- /Navigation Bar -->
    <center>
        <h3>Marketplace</h3>
        <img src="./images/Web_BG.png" height="100%">
        <div class="space"></div>
        <h5>Press Initialize then login to Metamask</h5>
        <h5>Then Select which one you would like to claim</h5>
        <h5>Make sure to confirm</h5>
        <div class="container">
            <div class="row">
                <button id="btn-logout" class="button1">Intialize</button>
                <button id="btn-login" class="button1">Sign into Metamask</button>
            </div>
            <div class="row">
                <button id="btn-1" class="button2">Buterin Genesis (3000)</button>
                <button id="btn-2" class="button2">Poker Night (1000)</button>
                <button id="btn-3" class="button2">Trivia Night (300)</button>
            </div>
            <div class="row"></div>
                <button id="btn-4" class="button2">Cowboy NFT (1000)</button>
                <button id="btn-5" class="button2">Riot Racer Car (500)</button>
                <button id="btn-6" class="button2">Trick or Treat (1500)</button>
            </div>
            <div class="row"></div>
                <button id="btn-7" class="button2">Chicken Derby (750)</button>
                <button id="btn-8" class="button2">Cowboy County Horse Stud (300)</button>
            </div>
        </div>
        
    </center>
    <script>
        // connect to Moralis server
        const serverUrl = "https://jsotamk6fp3e.usemoralis.com:2053/server";
        const appId = "mxC5xwV2xmfNGdc9Zoj7HdBidtMrvn7wB4hxS85X";
        Moralis.start({ serverUrl, appId });
        let user = null;
        var tokenId = 4000;

        async function login() {
            user = Moralis.User.current();
            if (!user) {
                user = await Moralis.authenticate({
                    signingMessage: "Log in to MetaMask",
                });
            }
        }

        async function logOut() {
            await Moralis.User.logOut();
        }
        async function doOne(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 3000){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 1);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a Buterin Genesis.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doTwo(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 1000){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 2);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a poker night.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doThree(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 300){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 3);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a trivia night.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doFour(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 1000){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 4);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a Cowboy.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doFive(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 500){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 5);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a Car.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doSix(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 1500){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 6);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a Mystery Box.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doSeven(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 750){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 7);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a Chicken.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }
        async function doEight(){
            const wallet = user.get("ethAddress");
            const walletst = Moralis.Object.extend("wallets");
            const walletq = new Moralis.Query(walletst);
            walletq.equalTo("wallet", wallet);
            const walletOBJ = await walletq.find();
            const previousCoins = objectToCoins(walletOBJ);
            if (previousCoins> 300){
                const walletsx = Moralis.Object.extend("wallets");
                const walletx = new walletsx();
                walletx.set("wallet", wallet);
                walletx.set("passive", previousCoins-3000);
                walletx.set("land", 0);
                walletx.set("colab", 0);
                walletx.save();
                const prizes = Moralis.Object.extend("prizes");
                const prize = new prizes();
                prize.set("wallet", wallet);
                prize.set("prize", 8);
                let discordID = window.prompt("Please enter your discord ID");
                prize.set("Discord", discordID);
                prize.save();
                window.alert("You have successfully redeemed a Stud.");
            }
            else{
                window.alert("Redemption unseccessfully");
            }
        }

        function objectToCoins(coinOBJ) {
            var passive = 0;
            var land=0;
            var colab = 0;
            if (coinOBJ.length == 0) {
                return 0;
            }
            const x = coinOBJ[coinOBJ.length - 1].attributes;
            for (const key in x) {
                if (key == "passive") {
                    passive = x[key];
                }
                if (key == "land") {
                    land = x[key];
                }
                if (key == "colab") {
                    colab = x[key];
                }
            }
            return passive+land+colab;
        }


        document.getElementById("btn-login").onclick = login;
        document.getElementById("btn-logout").onclick = logOut;
        document.getElementById("btn-1").addEventListener("click", doOne);
        document.getElementById("btn-2").addEventListener("click", doTwo);
        document.getElementById("btn-3").addEventListener("click", doThree);
        document.getElementById("btn-4").addEventListener("click", doFour);
        document.getElementById("btn-5").addEventListener("click", doFive);
        document.getElementById("btn-6").addEventListener("click", doSix);
        document.getElementById("btn-7").addEventListener("click", doSeven);
        document.getElementById("btn-8").addEventListener("click", doEight);
    </script>
</body>

</html>
